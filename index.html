<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <title>Ermis TTS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/x-icon" href="favicons/favicon.ico">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <style>
      :root {
        --tab-bg: #0f172a; /* slate-900 */
        --tab-muted: #1e293b; /* slate-800 */
        --tab-accent: #22d3ee; /* cyan-400 */
        --tab-text: #e2e8f0; /* slate-200 */
        --bd: #243041; /* border */
      }
      body { font-family: "Open Sans", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }

      /* --- Tabs --- */
      .tabs { margin: 24px auto 0; max-width: 1400px; width: calc(100% - 32px); background: #ffffff; border: 1px solid #e5e7eb; border-radius: 14px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,.08); }
      .tab-header { display: flex; flex-wrap: wrap; background: #f1f5f9; }
      .tab-btn { appearance: none; background: transparent; color: #0f172a; padding: 14px 18px; font-weight: 700; border: 0; cursor: pointer; position: relative; }
      .tab-btn[aria-selected="true"] { color: #0f172a; }
      .tab-btn[aria-selected="true"]::after { content: ""; position: absolute; left: 12px; right: 12px; bottom: 0; height: 3px; background: var(--tab-accent); border-radius: 3px 3px 0 0; }
      .tab-panel { display: none; padding: 22px; background: transparent; color: #0f172a; }
      .tab-panel.active { display: block; }

      /* Audio grid */
      .audio-folder { margin: 8px 0 0; border-top: 1px solid #e5e7eb; }
      .audio-folder summary { cursor: pointer; padding: 14px 18px; font-weight: 700; list-style: none; color: #0f172a; }
      .audio-folder summary::-webkit-details-marker { display: none; }
      .audio-folder summary span { opacity: .9; font-weight: 600; font-size: .95rem; color: #334155; }
      .audio-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 12px; padding: 0 18px 18px; }
      .audio-card { background: #ffffff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; }
      .audio-card .fn { display: block; font-size: .85rem; opacity: .85; margin-bottom: 6px; word-break: break-all; }
      .audio-card audio { width: 100%; }

      /* Emoção: controles e largura total */
      .emotion-controls { display:flex; align-items:center; gap:10px; padding: 0 0 16px 0; }
      .emotion-select { background:#ffffff; color:#0f172a; border:1px solid #e5e7eb; border-radius:8px; padding:8px 10px; }
      .emotion-matrix { display: block; width: 100%; }

      /* Header small fixes so it still looks ok */
      #page-header { position: relative; min-height: 220px; color: white; overflow: hidden; }
      #bg-header { position: absolute; inset: 0; background: radial-gradient(1200px 600px at 20% -10%, rgba(34,211,238,.25), transparent), radial-gradient(1000px 600px at 80% 0%, rgba(99,102,241,.25), transparent), linear-gradient(180deg, #0b1022 0%, #04070f 100%); }
      #demo-canvas { position: absolute; inset: 0; }
      .main-title { position: relative; z-index: 2; display: grid; place-items: center; padding: 56px 16px; text-align: center; }
      .project-name a { color: white; text-decoration: none; }
      .project-tagline { color: #c7d2fe; font-weight: 600; }
      .model-voice { 
              margin: 8px 0 0; 
              padding: 14px 18px; 
              background: #f1f5f9;
              border-top: 1px solid #e5e7eb;
              font-weight: 700;
              color: #0f172a;
              cursor: pointer;
              list-style: none;
              transition: background 0.2s ease;
      }

      .model-voice:hover {
        background: #e2e8f0;
      }
      .model-voice::-webkit-details-marker { display: none; }
      .model-voice span {
        opacity: .9;
        font-weight: 600;
        font-size: .95rem;
        color: #334155;
        margin-left: 8px;
      }
      .model-content {
        padding: 18px;
      }
      .model-grid { 
        display:grid; 
        grid-template-columns: repeat(auto-fill, minmax(320px,1fr)); 
        gap:16px; 
        margin-top: 16px;
      }
      .model-card { 
        background:#ffffff; 
        border:1px solid #e5e7eb; 
        border-radius:12px; 
        padding:14px; 
        display:flex; 
        flex-direction:column; 
        gap:10px;
        transition: all 0.2s ease;
        box-shadow: 0 1px 3px rgba(0,0,0,.06);
      }
      .model-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,.1);
        transform: translateY(-2px);
      }
      .model-card audio { 
        width:100%; 
        border-radius: 8px;
      }
      .model-card p { 
        margin:0; 
        font-size:.92rem; 
        line-height:1.5rem; 
        color:#334155;
        padding: 10px 12px;
        background: #f8fafc;
        border-radius: 8px;
        border-left: 3px solid var(--tab-accent);
      }
      .chips {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 8px;
      }
      .chip {
        display: inline-block;
        font-size: .75rem;
        font-weight: 700;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        background: #f8fafc;
        color: #0f172a;
      }
      .chip-group { border-color: #dcfce7; background: #f0fdf4; }       /* Grupo: Impact / Sad / Mid-Long */
      .chip-cap   { border-color: #73c8f6; background: #eff6ff; }   

      /* Painel de voz (Por emoção) seguindo o estilo de "Por modelo" */
      .voice-panel {
        background:#ffffff;
        border:1px solid #e5e7eb;
        border-radius:12px;
        padding:14px;
        margin:12px 0;
        box-shadow: 0 1px 3px rgba(0,0,0,.06);
      }
      .filename { 
        display:block; 
        font-size:.78rem; 
        color:#64748b; 
        margin-top:6px; 
        word-break: break-all; 
      }
    </style>
  </head>
  <body>
    <section id="page-header" class="page-header">
      <div id="bg-header"></div>
      <canvas id="demo-canvas"></canvas>
      <div class="main-title">
        <h1 class="project-name"><span><a href="index.html">Ermis TTS</a></span></h1>
        <h2 class="project-tagline">Síntese neural multilíngue com clonagem de voz e controle de emoção</h2>
      </div>
    </section>

    <section class="main-content">
      <!-- Links removidos/ocultos enquanto ajustamos para Ermis -->

      <!-- <div style="text-align: center;">
        <h2>Ermis TTS: The best TTS for everyone</h2>
        <p><b>Edresson Casanova, Julian Weber, Christopher Shulby, Arnaldo Candido Junior, Eren Gölge e Moacir Antonelli Ponti</b></p>
      </div> -->

      <h2>Descrição</h2>
      <p>
        <b>Ermis TTS</b> é um mecanismo de síntese de voz neural projetado para produção: suporta múltiplas vozes e idiomas, clonagem de voz (zero‑shot) a partir de poucos segundos de áudio e <i>style transfer</i> para emoções como <em>Impact</em>, <em>Sad</em> e variações de prosódia.
        A pilha foi otimizada para baixa latência, alto paralelismo e fácil implantação em servidores ou notebooks, mantendo qualidade natural e alta similaridade com a voz alvo. As amostras abaixo ilustram organização por voz, por emoção e por modelo.
      </p>


      <h2>Amostras Ermis-TTS</h2>

      <p><em>Importante:</em> nas abas <b>Por emoção</b> e <b>Por voz com texto</b>, o termo <b>“emoção”</b> refere-se somente ao <u>conteúdo do texto</u> (legenda) exibido — frases que evocam raiva, tristeza, medo etc. O áudio continua sendo a mesma voz/modelo; <b>não</b> aplicamos controle prosódico/estilo adicional nessas abas. Quando houver amostras com estilo de síntese (por exemplo, <code>Impact</code> ou <code>Sad</code>), isso aparecerá explicitamente no nome da pasta/arquivo (<code>pt_impact_#.wav</code>, <code>pt_sad_#.wav</code>).</p>


      <div class="tabs" role="tablist" aria-label="Amostras organizadas">
        <div class="tab-header">
          <!-- Ajuste: padrão agora é "Por voz com texto" -->
          <button class="tab-btn" role="tab" aria-selected="false" aria-controls="painel-voz" id="tab-voz">Por voz</button>
          <button class="tab-btn" role="tab" aria-selected="false" aria-controls="painel-emocao" id="tab-emocao">Por emoção</button>
          <button class="tab-btn" role="tab" aria-selected="true" aria-controls="painel-modelo" id="tab-modelo">Por voz com texto</button>
        </div>
        <div class="tab-panel" id="painel-voz" role="tabpanel" aria-labelledby="tab-voz">
          <p>Prévia por voz, separados por pasta. Expanda uma pasta para ver os áudios.</p>

          <details class="audio-folder" open>
            <summary>Voz Feminina 01<span>— Impact &amp; Sad</span></summary>
            <div class="audio-grid" data-base="audios_demo/Ermis/audios_gerados_spark_tts/output-enhanced-48khzv2/female-alc-dub/output" data-groups='[{"label":"Impact","prefix":"pt_impact_","start":0,"end":2},{"label":"Sad","prefix":"pt_sad_","start":0,"end":2}]'></div>
          </details>

          <details class="audio-folder">
            <summary>Voz Feminina 02<span>— Impact &amp; Sad</span></summary>
            <div class="audio-grid" data-base="audios_demo/Ermis/audios_gerados_spark_tts/output-enhanced-48khzv2/female-alc-dub-2/output" data-groups='[{"label":"Impact","prefix":"pt_impact_","start":0,"end":2},{"label":"Sad","prefix":"pt_sad_","start":0,"end":2}]'></div>
          </details>

          <details class="audio-folder">
            <summary>Voz Masculina 01<span>— Mid-Long</span></summary>
            <div class="audio-grid" data-base="audios_demo/Ermis/audios_gerados_spark_tts/output-enhanced-48khzv2/male-alc-dub/output" data-groups='[{"label":"Mid-Long","prefix":"pt_mid_long_","start":0,"end":5}]'></div>
          </details>

          <details class="audio-folder">
            <summary>Voz Masculina 02<span>— Mid-Long</span></summary>
            <div class="audio-grid" data-base="audios_demo/Ermis/audios_gerados_spark_tts/output-enhanced-48khzv2/male-alc-dub-2/output" data-groups='[{"label":"Mid-Long","prefix":"pt_mid_long_","start":0,"end":2},{"label":"Impact","prefix":"pt_impact_","start":0,"end":2}]'></div>
          </details>

          <!-- <details class="audio-folder">
            <summary>male-alc-dub-2_2 <span>— Impact</span></summary>
            <div class="audio-grid" data-base="audios_demo/Ermis/audios_gerados_spark_tts/output-enhanced-48khzv2/male-alc-dub-2_2/output" data-groups='[{"label":"Impact","prefix":"pt_impact_","start":0,"end":5}]'></div>
          </details> -->

          <!-- <details class="audio-folder">
            <summary>male-alc-dub-2_3 <span>— Sad</span></summary>
            <div class="audio-grid" data-base="audios_demo/Ermis/audios_gerados_spark_tts/output-enhanced-48khzv2/male-alc-dub-2_3/output" data-groups='[{"label":"Sad","prefix":"pt_sad_","start":0,"end":5}]'></div>
          </details> -->
        </div>
        <div class="tab-panel" id="painel-emocao" role="tabpanel" aria-labelledby="tab-emocao">
          <div class="emotion-controls">
            <label for="sel-pasta">Dataset:</label>
            <select id="sel-pasta" class="emotion-select">
              <option value="ALL">Todas</option>
              <option value="female-alc-dub">Voz Feminina 01</option>
              <option value="female-alc-dub-2">Voz Feminina 02</option>
              <option value="male-alc-dub">Voz Masculina 01</option>
              <option value="male-alc-dub-2">Voz Masculina 02</option>
            </select>
          </div>
          <div id="emotion-matrix" class="emotion-matrix" aria-live="polite"></div>
        </div>
        <div class="tab-panel active" id="painel-modelo" role="tabpanel" aria-labelledby="tab-modelo">
          <div id="modelo-wrap"></div>
        </div>

      </div>

      <!-- <footer class="site-footer">
        <a href="https://coqui.ai/" title="Coqui AI" target="blank"><img src="img/coqui.png" border="0" height="40" alt="Coqui AI"></a>
        <a href="http://www.defined.ai/" title="Defined.ai" target="blank"><img src="img/df.jpeg" border="0" height="50" alt="Defined.ai"></a>
        <a href="http://www.deeplearningbrasil.com.br/" title="Deep Learning Brasil" target="blank"><img src="img/dlb.png" border="0" height="50" alt="Deep Learning Brasil"></a>
        <a href="http://icmc.usp.br/" title="Institute of Mathematics and Computer Science (ICMC)" target="blank"><img src="img/icmc.png" border="0" height="55" alt="ICMC"></a>
        <a href="https://www.soprabanking.com/" title="Sopra Banking Software" target="blank"><img src="img/sbs.png" border="0" height="38" alt="Sopra Banking Software"></a>
        <div class="cleaner"></div>
      </footer> -->
    </section>

    <script>
      // Tabs simples
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabPanels = document.querySelectorAll('.tab-panel');
      tabButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          tabButtons.forEach((b) => b.setAttribute('aria-selected', 'false'));
          btn.setAttribute('aria-selected', 'true');
          tabPanels.forEach((p) => p.classList.remove('active'));
          document.getElementById(btn.getAttribute('aria-controls')).classList.add('active');
        });
      });
    </script>

    <script>
  // Constrói os cartões de áudio a partir dos atributos data-* em cada .audio-grid
  function buildAudioGrids() {
    const grids = document.querySelectorAll('.audio-grid');
    grids.forEach(grid => {
      const base = grid.getAttribute('data-base');
      /** @type {{label:string,prefix:string,start:number,end:number}[]} */
      const groups = JSON.parse(grid.getAttribute('data-groups') || '[]');
      groups.forEach(group => {
        for (let i = group.start; i <= group.end; i++) {
          const filename = `${group.prefix}${i}.wav`;
          const card = document.createElement('div');
          card.className = 'audio-card';

          const label = document.createElement('span');
          label.className = 'fn';
          label.textContent = (group.label ? String(group.label).toLowerCase() : 'audio');

          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = `${base}/${filename}`;
          audio.preload = 'none';

          card.appendChild(label);
          card.appendChild(audio);
          grid.appendChild(card);
        }
      });
    });
  }

  // Inicializa quando a aba "Por voz" estiver ativa pela primeira vez
  const painelVoz = document.getElementById('painel-voz');
  let audiosBuilt = false;
  const ensureBuild = () => { if (!audiosBuilt) { buildAudioGrids(); audiosBuilt = true; } };
  if (painelVoz.classList.contains('active')) ensureBuild();
  document.getElementById('tab-voz').addEventListener('click', ensureBuild);
</script>


<script>
  // --- POR EMOÇÃO ---
  const EMOTION_LABELS = {
    'angry': 'Raiva',
    'fear': 'Medo',
    'happy': 'Felicidade',
    'sad': 'Tristeza',
    'surprise': 'Surpresa',
    'neutral': 'Neutro'
  };
  const EMOTION_ORDER = ['angry','fear','happy','sad','surprise','neutral'];

  // Configuração dos datasets baseada na estrutura de pastas existente
  const DATASETS = {
    Dublagem: {
      base: 'audios_demo/emocao/dublagem',
      genders: {
        female: {
          displayPrefix: 'feminino',
          byEmotion: {
            angry: [
              { id: '50', groupId: 50, refFile: '9075656efc.wav', samples: ['angry_50-0.wav','angry_50-5.wav','angry_50-6.wav'] },
              { id: '56', groupId: 56, refFile: '227e980cda.wav', samples: ['angry_56-2.wav','angry_56-3.wav','angry_56-8.wav'] }
            ],
            fear: [
              { id: '27', groupId: 27, refFile: '93d53c3da4.wav', samples: ['fear_27-5.wav','fear_27-7.wav','fear_27-8.wav'] },
              { id: '53', groupId: 53, refFile: 'd724b914b9.wav', samples: ['fear_53-5.wav','fear_53-7.wav','fear_53-8.wav'] }
            ],
            happy: [
              { id: '38', groupId: 38, refFile: '7bb653bf39.wav', samples: ['happy_38-2.wav','happy_38-5.wav','happy_38-9.wav'] },
              { id: '48', groupId: 48, refFile: '80cab7dda5.wav', samples: ['happy_48-5.wav','happy_48-6.wav','happy_48-8.wav'] },
              { id: '49', groupId: 49, refFile: '49194a6615.wav', samples: ['happy_49-4.wav','happy_49-5.wav','happy_49-9.wav'] }
            ],
            sad: [
              { id: '40', groupId: 40, refFile: 'f7342f70e4.wav', samples: ['sad_40-0.wav','sad_40-7.wav','sad_40-9.wav'] },
              // { id: '43', groupId: 43, refFile: 'c287ad9214.wav', samples: ['sad_43-0.wav','sad_43-1.wav','sad_43-2.wav','sad_43-3.wav','sad_43-4.wav','sad_43-5.wav','sad_43-6.wav','sad_43-7.wav','sad_43-8.wav','sad_43-9.wav'] },
              { id: '51', groupId: 51, refFile: 'f9fc95197b.wav', samples: ['sad_51-3.wav','sad_51-4.wav','sad_51-7.wav'] },
              { id: '52', groupId: 52, refFile: '4296e717f5.wav', samples: ['sad_52-6.wav','sad_52-7.wav','sad_52-8.wav'] }
            ],
            surprise: [
              { id: '26', groupId: 26, refFile: 'ffb08db167.wav', samples: ['surprise_26-4.wav','surprise_26-8.wav','surprise_26-9.wav'] },
              { id: '36', groupId: 36, refFile: '592cd7c510.wav', samples: ['surprise_36-2.wav','surprise_36-7.wav','surprise_36-9.wav'] },
              { id: '37', groupId: 37, refFile: 'c6e50e472f.wav', samples: ['surprise_37-2.wav','surprise_37-7.wav','surprise_37-9.wav'] }
            ]
          }
        },
        male: {
          displayPrefix: 'masculino',
          byEmotion: {
            angry: [
              { id: '0', groupId: 0, refFile: '2934e86276.wav', samples: ['angry_0-0.wav','angry_0-4.wav','angry_0-6.wav'] },
              { id: '1', groupId: 1, refFile: '8bef5fe262.wav', samples: ['angry_1-1.wav','angry_1-2.wav','angry_1-3.wav'] },
              { id: '3', groupId: 3, refFile: 'f86b21b285.wav', samples: ['angry_3-6.wav','angry_3-7.wav','angry_3-8.wav'] },
              
            ],
            fear: [
              { id: '4', groupId: 4, refFile: '5f40613cc9.wav', samples: ['fear_4-1.wav','fear_4-5.wav','fear_4-9.wav'] },
              { id: '15', groupId: 15, refFile: '3c0d3ba72c.wav', samples: ['fear_15-1.wav','fear_15-4.wav','fear_15-6.wav'] }
            ],
            happy: [
              { id: '2', groupId: 2, refFile: null, samples: ['happy_2-4.wav','happy_2-8.wav','happy_2-9.wav'] },
              { id: '16', groupId: 16, refFile: '515937ef07.wav', samples: ['happy_16-2.wav','happy_16-4.wav','happy_16-9.wav'] }
            ]
          }
        }
      }
    },
    EmoUERJ: {
      base: 'audios_demo/emocao/EmoUERJ',
      genders: {
        masculino: {
          displayPrefix: 'masculino',
          byEmotion: {
            angry: [
              { id: 'ator1', actor:'ator1', refFile: '0023_4.wav', samples: ['angry_91-4.wav','angry_91-6.wav'] },
              { id: 'ator2', actor:'ator2', refFile: '0146_5.wav', samples: ['angry_85-3.wav','angry_85-5.wav','angry_85-6.wav'] },
              { id: 'ator3', actor:'ator3', refFile: '0088_0.wav', samples: ['angry_92-1.wav','angry_92-4.wav','angry_92-5.wav'] }
            ],
            happy: [
              { id: 'ator1', actor:'ator1', refFile: '0153_5.wav', samples: ['happy_59-4.wav','happy_59-6.wav','happy_59-9.wav'] }
            ],
            neutral: [
              { id: 'ator1', actor:'ator1', refFile: '0206_2.wav', samples: ['neutral_69-2.wav','neutral_69-4.wav','neutral_69-5.wav'] },
              { id: 'ator2', actor:'ator2', refFile: '0182_5.wav', samples: ['neutral_70-3.wav','neutral_70-6.wav','neutral_70-7.wav'] },
              { id: 'ator3', actor:'ator3', refFile: '0173_5.wav', samples: ['neutral_68-1.wav','neutral_68-5.wav','neutral_68-7.wav'] }
            ],
            sad: [
              { id: 'ator1', actor:'ator1', refFile: '0053_0.wav', samples: ['sad_75-5.wav','sad_75-6.wav','sad_75-7.wav'] },
              { id: 'ator2', actor:'ator2', refFile: null, samples: ['sad_76-6.wav','sad_76-7.wav','sad_76-9.wav'] },
              { id: 'ator3', actor:'ator3', refFile: '0050_0.wav', samples: ['sad_77-2.wav','sad_77-4.wav','sad_77-6.wav'] },
              { id: 'ator4', actor:'ator4', refFile: null, samples: ['sad_80-1.wav','sad_80-4.wav','sad_80-9.wav'] }
            ]
          }
        },
        feminino: {
          displayPrefix: 'feminino',
          byEmotion: {
            angry: [
              { id: 'ator1', actor:'ator1', refFile: null, samples: ['angry_98-4.wav'] }
            ],
            happy: [
              { id: 'ator1', actor:'ator1', refFile: '0343_7.wav', samples: ['happy_64-0.wav','happy_64-2.wav','happy_64-8.wav'] }
            ],
            neutral: [
              { id: 'ator1', actor:'ator1', refFile: '0322_3.wav', samples: ['neutral_71-4.wav','neutral_71-6.wav','neutral_71-8.wav'] }
            ],
            sad: [
              { id: 'ator1', actor:'ator1', refFile: '0090_6.wav', samples: ['sad_83-0.wav','sad_83-2.wav','sad_83-6.wav'] }
            ]
          }
        }
      }
    }
  };

  function ensureEmotionSelectorOptions() {
    const sel = document.getElementById('sel-pasta');
    if (!sel || sel.dataset.inited === '1') return;
    sel.innerHTML = '';
    const optAll = document.createElement('option');
    optAll.value = 'ALL';
    optAll.textContent = 'Todos';
    sel.appendChild(optAll);
    Object.keys(DATASETS).forEach(ds => {
      const opt = document.createElement('option');
      opt.value = ds;
      opt.textContent = ds;
      sel.appendChild(opt);
    });
    sel.dataset.inited = '1';
  }

  function buildEmotionMatrix(selectedDataset = 'ALL') {
    const container = document.getElementById('emotion-matrix');
    container.innerHTML = '';

    const datasetsToShow = selectedDataset === 'ALL' ? Object.keys(DATASETS) : [selectedDataset];

    const voiceNumberMap = {}; // {dataset:{gender:{id:num}}}
    const voiceCounters = {}; // {dataset:{gender:count}}

    function getVoiceNumber(datasetName, gender, uniqueId) {
      voiceNumberMap[datasetName] ||= {};
      voiceCounters[datasetName] ||= {};
      voiceNumberMap[datasetName][gender] ||= {};
      voiceCounters[datasetName][gender] ||= 5;
      if (!(uniqueId in voiceNumberMap[datasetName][gender])) {
        const n = voiceCounters[datasetName][gender];
        voiceNumberMap[datasetName][gender][uniqueId] = n;
        voiceCounters[datasetName][gender] = n + 1;
      }
      return voiceNumberMap[datasetName][gender][uniqueId];
    }

    datasetsToShow.forEach(dsName => {
      const ds = DATASETS[dsName];
      if (!ds) return;

      // Dataset como bloco "model-voice" para manter consistência visual
      const dsDetails = document.createElement('details');
      dsDetails.className = 'model-voice';
      dsDetails.setAttribute('open','');
      const dsSummary = document.createElement('summary');
      dsSummary.textContent = dsName;
      dsDetails.appendChild(dsSummary);

      const dsContent = document.createElement('div');
      dsContent.className = 'model-content';

      EMOTION_ORDER.forEach(em => {
        const gendersKeys = Object.keys(ds.genders);
        const hasVoices = gendersKeys.some(g => (ds.genders[g].byEmotion[em] || []).length);
        if (!hasVoices) return;

        // Emoção como sub-bloco colapsável no mesmo estilo
        const emoDetails = document.createElement('details');
        emoDetails.className = 'model-voice';
        emoDetails.setAttribute('open','');
        const emoSummary = document.createElement('summary');
        emoSummary.textContent = EMOTION_LABELS[em] || em;
        emoDetails.appendChild(emoSummary);

        const emoContent = document.createElement('div');
        emoContent.className = 'model-content';

        gendersKeys.forEach(gender => {
          const genderCfg = ds.genders[gender];
          const voiceList = genderCfg.byEmotion[em] || [];
          voiceList.forEach(v => {
            const voiceNum = getVoiceNumber(dsName, gender, v.id);
            const voiceName = `${genderCfg.displayPrefix} ${voiceNum}`;

            // Painel de voz no estilo do "Por modelo"
            const panel = document.createElement('div');
            panel.className = 'voice-panel';

            // Cabeçalho com chips de contexto
            const chips = document.createElement('div');
            chips.className = 'chips';
            const chipDs = document.createElement('span'); chipDs.className = 'chip'; chipDs.textContent = dsName;
            const chipEm = document.createElement('span'); chipEm.className = 'chip chip-cap'; chipEm.textContent = EMOTION_LABELS[em] || em;
            const chipGen = document.createElement('span'); chipGen.className = 'chip'; chipGen.textContent = genderCfg.displayPrefix;
            const chipVoice = document.createElement('span'); chipVoice.className = 'chip'; chipVoice.textContent = voiceName;
            chips.appendChild(chipDs);
            chips.appendChild(chipEm);
            chips.appendChild(chipGen);
            chips.appendChild(chipVoice);
            panel.appendChild(chips);

            // Áudio de referência (quando existir)
            if (v.refFile) {
              const refContainer = document.createElement('div');
              refContainer.className = 'ref-audio';
              const refAudio = document.createElement('audio');
              refAudio.controls = true;
              refAudio.preload = 'none';
              if (dsName === 'Dublagem') {
                refAudio.src = `${ds.base}/${gender}/${em}/${v.groupId}/referencia/${v.refFile}`;
              } else if (dsName === 'EmoUERJ') {
                refAudio.src = `${ds.base}/${em}/${gender}/${v.actor}/referencia/${v.refFile}`;
              }
              const refLabel = document.createElement('span');
              refLabel.textContent = 'Áudio de referência';
              refContainer.appendChild(refAudio);
              refContainer.appendChild(refLabel);
              panel.appendChild(refContainer);
            }

            // Grid de amostras no estilo "model-grid" + "model-card"
            const samplesGrid = document.createElement('div');
            samplesGrid.className = 'model-grid';
            (v.samples || []).forEach(fn => {
              const card = document.createElement('div');
              card.className = 'model-card';
              const audio = document.createElement('audio');
              audio.controls = true;
              audio.preload = 'none';
              if (dsName === 'Dublagem') {
                audio.src = `${ds.base}/${gender}/${em}/${v.groupId}/${fn}`;
              } else if (dsName === 'EmoUERJ') {
                audio.src = `${ds.base}/${em}/${gender}/${v.actor}/${fn}`;
              }
              const label = document.createElement('span');
              label.className = 'filename';
              label.textContent = fn;
              card.appendChild(audio);
              card.appendChild(label);
              samplesGrid.appendChild(card);
            });
            panel.appendChild(samplesGrid);

            emoContent.appendChild(panel);
          });
        });

        emoDetails.appendChild(emoContent);
        dsContent.appendChild(emoDetails);
      });

      dsDetails.appendChild(dsContent);
      container.appendChild(dsDetails);
    });
  }

  // Inicialização da aba "Por emoção"
  const selPasta = document.getElementById('sel-pasta');
  const painelEmocao = document.getElementById('painel-emocao');
  let emotionBuilt = false;
  function ensureEmotionBuild() {
    ensureEmotionSelectorOptions();
    if (!emotionBuilt) {
      buildEmotionMatrix(selPasta.value || 'ALL');
      emotionBuilt = true;
    }
  }
  document.getElementById('tab-emocao').addEventListener('click', ensureEmotionBuild);
  if (painelEmocao.classList.contains('active')) ensureEmotionBuild();
  if (selPasta) selPasta.addEventListener('change', () => buildEmotionMatrix(selPasta.value));
</script>

<style>
  /* opcional: deixa o bloco do áudio de referência bonitinho */
  .ref-audio {
    display:flex; align-items:center; gap:10px;
    margin: 6px 0 14px;
    padding:10px; border:1px solid #e5e7eb; border-radius:10px; background:#ffffff;
    font-weight:600; color:#0f172a;
  }
  .ref-audio audio { width: 320px; max-width: 100%; }
</style>

<script>
  // --- POR MODELO (com áudio de referência por voz + sequência de legendas) ---
  const MODEL_BASE_ROOT = 'audios_demo/Ermis/audios_gerados_spark_tts/output-enhanced-48khzv2';

  // >>> Base dos áudios de referência (ajuste se mudar a pasta)
  const REF_BASE_ROOT = 'audios_demo/Ermis/audios_gerados_spark_tts/output1';
  // >>> Arquivos de referência por voz/pasta (TROQUE os nomes conforme os seus arquivos)
  const REF_VOICE_FILES = {
    'female-alc-dub':  'example_female_dub_2.wav',     // Voz Feminina 01
    'female-alc-dub-2':'example_female_dub_3_v2.wav',  // Voz Feminina 02
    'male-alc-dub':    'example_male_dub.wav',         // Voz Masculina 01
    'male-alc-dub-2':  'example_male_dub_2.wav'        // Voz Masculina 02
  };

  const CAPTIONS = {
    raiva: [
      "Eu já tô exausto de promessas vazias; chega de desculpas, eu quero resultado agora.",
      "Se empurraram esse problema pra amanhã de novo, eu vou bater a porta com força.",
      "Não me venha com meia-verdade; a verdade inteira dói, mas resolve.",
      "Horas de fila, zero respeito: é assim que tratam quem paga a conta?",
      "Falar é fácil; difícil é encarar o caos que vocês mesmos criaram.",
      "Pare de culpar o trânsito; o atraso é de quem nunca se planeja.",
      "Quando a paciência acaba, até o silêncio vira grito preso na garganta.",
      "Prometeram transparência, mas trancaram tudo a sete chaves; que piada amarga.",
      "Eu avisei mil vezes; agora consertem o estrago sem chororô.",
      "Batem no peito por eficiência, mas tropeçam no básico, todos os dias.",
      "Se é pra fingir que está tudo bem, prefiro o barulho da revolta.",
      "Chega de empurrar com a barriga; ou enfrentamos isso, ou afundamos juntos.",
      "Você me cobra calma, mas foi você quem riscou o fósforo.",
      "A cada desculpa nova, minha vontade de ir embora cresce mais um palmo.",
      "O relógio marcou 23:47 e ainda estou aqui, preso à sua desorganização."
    ],
    emocao: [
      "Quando a chuva tocou a janela, senti sua ausência como um eco longo no peito.",
      "Ela segurou a carta com dedos trêmulos e sorriu como quem reencontra o próprio nome.",
      "No silêncio da madrugada, a cidade respirou fundo e me emprestou coragem.",
      "Eu tentei ser forte, mas a saudade atravessou a sala como um relâmpago manso.",
      "Se a vida pedir paciência, eu prometo ficar, mesmo que a noite demore a passar.",
      "Quando ele disse 'volto logo', o relógio aprendeu a andar devagar.",
      "Entre o café amargo e o abraço tardio, descobri que ainda sei recomeçar.",
      "Ela achou beleza nas rachaduras da parede e chamou aquilo de casa.",
      "Se eu me perder, que seja no sussurro do seu riso, onde tudo faz sentido.",
      "Eu vi o mar e pensei no futuro; a maré subia como um convite à mudança.",
      "A esperança cabe inteira num gesto pequeno: um copo d'água, uma porta aberta.",
      "Ele chorou em silêncio, e mesmo assim a sala ficou cheia de tempestade.",
      "Quando a música começou, a memória abriu janelas que eu nem lembrava que existiam.",
      "Se o medo apertar, respira comigo; prometo que o mundo fica menor.",
      "No primeiro raio de sol, percebi: sobrevivi à noite, e isso já é vitória."
    ],
    medo: [
      "Por causa do trânsito intenso, chegamos à reunião um pouco atrasados.",
      "Se você quiser ter sucesso, deve estar preparado para trabalhar muito duro e manter o foco.",
      "Antes de sair de férias, lembre-se de regar as plantas e trancar todas as portas.",
      "Eu tentei ser forte, mas a saudade atravessou a sala como um relâmpago manso.",
      "Se a vida pedir paciência, eu prometo ficar, mesmo que a noite demore a passar.",
      "Quando ele disse 'volto logo', o relógio aprendeu a andar devagar.",
      "Entre o café amargo e o abraço tardio, descobri que ainda sei recomeçar.",
      "Ela achou beleza nas rachaduras da parede e chamou aquilo de casa.",
      "Se eu me perder, que seja no sussurro do seu riso, onde tudo faz sentido.",
      "Eu vi o mar e pensei no futuro; a maré subia como um convite à mudança.",
      "A esperança cabe inteira num gesto pequeno: um copo d'água, uma porta aberta.",
      "Ele chorou em silêncio, e mesmo assim a sala ficou cheia de tempestade.",
      "Quando a música começou, a memória abriu janelas que eu nem lembrava que existiam.",
      "Se o medo apertar, respira comigo; prometo que o mundo fica menor.",
      "No primeiro raio de sol, percebi: sobrevivi à noite, e isso já é vitória."
    ],
    portuguese_sentences_mid_long : [
      "Embora estivesse chovendo, eles decidiram passear na floresta.",
      "Por causa do trânsito intenso, chegamos à reunião um pouco atrasados.",
      "Mesmo se sentindo cansada, ela continuou a trabalhar em seu projeto até tarde da noite.",
      "Se você quer ter sucesso, deve estar preparado para trabalhar muito duro e manter o foco.",
      "Antes de sair de férias, lembre-se de regar as plantas e trancar todas as portas.",
      "Depois de terminar o trabalho, ele relaxou ouvindo música clássica e lendo um livro.",
      "Enquanto as crianças brincavam no jardim, seus pais preparavam o almoço na cozinha.",
      "Apesar das dificuldades, eles conseguiram concluir o projeto com sucesso e no prazo.",
      "Considerando a previsão do tempo, pode ser uma boa ideia levar um guarda-chuva com você hoje.",
      "Para melhorar suas habilidades de comunicação, pratique falar em público e ouça ativamente os outros.",
      "Para atingir seus objetivos, é importante definir metas realistas e criar um plano.",
      "Sempre que me sinto estressado, gosto de dar uma caminhada no parque ou ouvir música calmante.",
      "Assim que o filme começou, as luzes diminuíram e todos ficaram quietos no teatro.",
      "Como era feriado, muitas famílias decidiram passar o dia na praia ou no campo.",
      "Antes de tomar uma decisão, é sempre sensato considerar todas as opções e resultados possíveis.",
      "Embora nunca tivesse tentado antes, ele achou o snowboard surpreendentemente divertido e emocionante.",
      "Como ela era muito organizada e eficiente, sempre conseguia terminar suas tarefas rapidamente.",
      "Mesmo que o restaurante estivesse lotado, eles encontraram uma mesa agradável perto da janela com uma ótima vista.",
      "Se você está planejando viajar para o exterior, é essencial ter um passaporte válido e quaisquer vistos necessários.",
      "Antes de iniciar qualquer novo programa de exercícios, é aconselhável consultar seu médico ou um especialista em fitness.",
      "Depois de passar muitos anos morando na cidade, eles decidiram se mudar para uma vila tranquila e pacífica.",
      "Enquanto o chef preparava o prato principal, os garçons estavam preparando as mesas para a noite.",
      "Apesar dos contratempos iniciais, a equipe perseverou e acabou atingindo seus objetivos de longo prazo.",
      "Considerando a complexidade da situação, é importante abordar o problema com planejamento e estratégia cuidadosos.",
      "Para garantir o sucesso do evento, precisamos coordenar todos os diferentes aspectos e trabalhar juntos de forma eficaz."
    ]
  };

  const DEFAULT_CAP_BY_GROUP = { 'Impact': 'raiva', 'Sad': 'emocao', 'Mid-Long': 'emocao' };

  /* Rótulos amigáveis para exibir a emoção do texto */
  const CAPTION_DISPLAY = {
    raiva: 'Raiva',
    emocao: 'Emoção',
    medo: 'Medo',
    portuguese_sentences_mid_long: 'Mid-Long (texto)'
  };

  // Sequência por grupo (1-based) — edite à vontade:
  const MODEL_VOICES = [
    { folder: 'female-alc-dub', label: 'Voz Feminina 01',
      groups: [
        { label: 'Impact',  prefix: 'pt_impact_',   start: 0, end: 2, cap: 'raiva',  capSeq: [1,5,12] },
        { label: 'Sad',     prefix: 'pt_sad_',      start: 0, end: 2, cap: 'emocao', capSeq: [2,7,13] }
      ]
    },
    { folder: 'female-alc-dub-2', label: 'Voz Feminina 02',
      groups: [
        { label: 'Impact',  prefix: 'pt_impact_',   start: 0, end: 2, cap: 'raiva',  capSeq: [3,9,14] },
        { label: 'Sad',     prefix: 'pt_sad_',      start: 0, end: 2, cap: 'emocao', capSeq: [1,4,13] }
      ]
    },
    { folder: 'male-alc-dub', label: 'Voz Masculina 01',
      groups: [
        { label: 'Mid-Long', prefix: 'pt_mid_long_', start: 0, end: 5, cap: 'portuguese_sentences_mid_long', capSeq: [2,6,5,13,15,17] },
      ]
    },
    { folder: 'male-alc-dub-2', label: 'Voz Masculina 02',
      groups: [
        { label: 'Impact',  prefix: 'pt_impact_',   start: 0, end: 2, cap: 'raiva',  capSeq: [1,3,4] },
        { label: 'Mid-Long', prefix: 'pt_mid_long_', start: 0, end: 2, cap: 'portuguese_sentences_mid_long', capSeq: [2,4,21] },
      ]
    }
  ];

  // Rotação por chave dinâmica
  const capIndex = {};
  function nextCaption(key) {
    const arr = CAPTIONS[key] || [];
    if (!arr.length) return '';
    capIndex[key] = (capIndex[key] || 0);
    const i = capIndex[key] % arr.length;
    capIndex[key] += 1;
    return arr[i];
  }

  // Pega legenda segundo a sequência do grupo; se não houver, usa rotação
  function getCaptionFor(capKey, group, fileIdx) {
    const arr = CAPTIONS[capKey] || [];
    if (!arr.length) return '';
    if (Array.isArray(group.capSeq) && group.capSeq.length) {
      const localPos = (fileIdx - group.start);
      const chosenOneBased = group.capSeq[ localPos % group.capSeq.length ];
      const chosenZeroBased = Math.max(1, Number(chosenOneBased) || 1) - 1;
      return arr[ chosenZeroBased % arr.length ];
    }
    return nextCaption(capKey);
  }

  // === AJUSTE: cada cartão mostra também o "grupo" e a "emoção do texto"
  function buildModelPanel() {
    const wrap = document.getElementById('modelo-wrap');
    if (!wrap) return;
    wrap.innerHTML = '';

    // zera índices de rotação
    Object.keys(CAPTIONS).forEach(k => capIndex[k] = 0);

    MODEL_VOICES.forEach((v, idx) => {
      // Cria bloco colapsável por voz
      const det = document.createElement('details');
      det.className = 'model-voice';
      if (idx === 0) det.setAttribute('open', ''); // opcional: primeira aberta

      const sum = document.createElement('summary');
      sum.textContent = v.label;
      det.appendChild(sum);

      // Conteúdo da voz
      const content = document.createElement('div');
      content.className = 'model-content';

      // Áudio de referência por voz (se houver)
      const refName = REF_VOICE_FILES[v.folder];
      if (refName) {
        const ref = document.createElement('div');
        ref.className = 'ref-audio';

        const audioRef = document.createElement('audio');
        audioRef.controls = true;
        audioRef.preload = 'none';
        audioRef.src = `${REF_BASE_ROOT}/${refName}`;

        const tag = document.createElement('span');
        tag.textContent = 'Áudio de referência';

        ref.appendChild(audioRef);
        ref.appendChild(tag);
        content.appendChild(ref);
      }

      // Grid de cartões (áudio + chips + legenda)
      const grid = document.createElement('div');
      grid.className = 'model-grid';

      v.groups.forEach(g => {
        const capKey = g.cap || DEFAULT_CAP_BY_GROUP[g.label] || 'emocao';
        const capLabel = CAPTION_DISPLAY[capKey] || capKey;

        for (let i = g.start; i <= g.end; i++) {
          const filename = `${g.prefix}${i}.wav`;

          const card = document.createElement('div');
          card.className = 'model-card';

          // Chips de metadados
          const chips = document.createElement('div');
          chips.className = 'chips';

          const chipGroup = document.createElement('span');
          chipGroup.className = 'chip chip-group';
          chipGroup.textContent = g.label; // Impact / Sad / Mid-Long


          chips.appendChild(chipGroup);
         

          // Player de áudio
          const audio = document.createElement('audio');
          audio.controls = true;
          audio.preload = 'none';
          audio.src = `${MODEL_BASE_ROOT}/${v.folder}/output/${filename}`;

          // Legenda (frase) escolhida
          const line = document.createElement('p');
          line.textContent = getCaptionFor(capKey, g, i);

          // Monta o cartão
          card.appendChild(chips);
          card.appendChild(audio);
          card.appendChild(line);
          grid.appendChild(card);
        }
      });

      content.appendChild(grid);
      det.appendChild(content);
      wrap.appendChild(det);
    });
  }

  // Carrega quando abrir a aba
  const tabModeloBtn = document.getElementById('tab-modelo');
  const painelModelo = document.getElementById('painel-modelo');
  let modelBuilt = false;
  function ensureModelBuild() { if (!modelBuilt) { buildModelPanel(); modelBuilt = true; } }
  tabModeloBtn.addEventListener('click', ensureModelBuild);
  if (painelModelo.classList.contains('active')) ensureModelBuild();
</script>

    <script src="js/animheader.js"></script>
  </body>
</html>